/* mooTblSort - Copyright (c) 2008 Adam Euans [adam.euans@gmail.com] */
var mooTblSort=new Class({options:{onStart:null,onComplete:null,tbl:null,ignore:[],handle:[]},initialize:function(d,e){e=e||{};e['tbl']=$(d);$extend(this.options,e);if($type(this.options['ignore'])!='array')this.options['ignore']=[this.options['ignore']];this._dragObj;this._dragObjIndex;this._dragTmpObj;this.rows=this.options['tbl'].getElements('tr').filter(function(a,b){return!(this.options['ignore'].indexOf(a)>=0)},this);this.rows.each(function(a,b,c){this._sort(a,b,c)},this);document.addEvent('mouseup',function(){if(this._dragObj){this.options.tbl.enableSelection();if($type(this.options.onComplete)=='function')this.options.onComplete(this._dragObj,this.rows.indexOf(this._dragObj),this.rows);this._dragObj=null}}.bind(this))},_sort:function(b,c,d){var e=(this.options['handle'].length)?$$(this.options['handle']).filter(function(a){return b.hasChild(a)},this):b;$$(($splat(e).length)?e:b).addEvent('mousedown',function(){this._dragObj=b;this._dragObjIndex=b.rowIndex;this._dragTmpObj=b;this.options.tbl.disableSelection();if($type(this.options.onStart)=='function')this.options.onStart(b,c,d)}.bind(this));b.addEvents({'mouseenter':function(){if(!this._dragObj||b.tagName=='input'||b.tagName=='select')return true;this._dragObj.inject(this.options.tbl.getElements('tr')[b.rowIndex],((this._dragTmpObj.rowIndex<b.rowIndex)?'after':'before'));this._dragTmpObj=b}.bind(this)})},reset:function(c){var d=this.rows[0];this.rows.each(function(a,b){a.inject(this.options.tbl.rows[b],'after')}.bind(this));if(c&&$type(c.onComplete)=='function')c.onComplete()}});Native.implement([Element],{disableSelection:function(){this.onselectstart=function(){return false};this.unselectable="on";this.style.MozUserSelect="none";this.style.cursor="default";return this},enableSelection:function(){this.onselectstart=null;this.unselectable="off";this.style.MozUserSelect="";this.style.cursor="";return this}});